<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pacific Shipping Simulation</title>
  <style>
    body { margin: 0; background: #f5f5f5; }
    canvas { display: block; margin: auto; background: #fff; border: 1px solid #ccc; }
    #info { text-align: center; margin: 10px; font-family: Arial; }
  </style>
</head>
<body>

<div id="info">ğŸš¢ í™˜íƒœí‰ì–‘ í•´ìƒ ì‹œë®¬ë ˆì´ì…˜</div>
<canvas id="mapCanvas" width="1200" height="800"></canvas>

<script>
const canvas = document.getElementById("mapCanvas");
const ctx = canvas.getContext("2d");

// SVG â†’ PNG ë³€í™˜ëœ ê³ í•´ìƒë„ ì§€ë„ (Natural Earth, Pacific focus)
const mapImage = new Image();
// ì•„ë˜ URLì€ ì˜ˆì‹œ, ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” í™˜íƒœí‰ì–‘ë§Œ ë³´ì´ë„ë¡ ì˜ë¼ë‚¸ SVG/PNGë¥¼ ì‚¬ìš©í•˜ëŠ” ê²Œ ê¶Œì¥ë©ë‹ˆë‹¤
mapImage.src = "https://upload.wikimedia.org/wikipedia/commons/8/80/World_map_-_low_resolution.svg";

// í•­êµ¬ ë°ì´í„° (ë¹¨ê°„ ì )
const ports = [
  {"id":"2001","port":"Tokyo","lat":35.6762,"lon":139.6503},
  {"id":"1001","port":"Los Angeles","lat":33.7406,"lon":-118.276},
  {"id":"3001","port":"Veracruz","lat":19.1738,"lon":-96.1342}
];

// í•´ìƒ ê²½ë¡œ (í•­êµ¬ + ë°”ë‹¤ ê²½ìœ ì§€)
const route = [
  {lat:35.6762, lon:139.6503},    // Tokyo
  {lat:38.0, lon:170.0},          // Pacific mid
  {lat:33.7406, lon:-118.276},    // Los Angeles
  {lat:25.0, lon:-110.0},         // Mexico Gulf entry
  {lat:19.1738, lon:-96.1342}     // Veracruz
];

// ë°° ê°ì²´
let ship = {
  lat: route[0].lat,
  lon: route[0].lon,
  routeIndex: 1
};

const speed = 1000; // km / step (5ì´ˆ)

// ìœ„ê²½ë„ â†’ XY ë³€í™˜
function latLonToXY(lat, lon, width, height) {
  const x = (lon + 180) * (width / 360);
  const y = (90 - lat) * (height / 180);
  return {x, y};
}

// Haversine ê±°ë¦¬ê³„ì‚°
function distance(lat1, lon1, lat2, lon2) {
  const R = 6371;
  const dLat = (lat2-lat1) * Math.PI / 180;
  const dLon = (lon2-lon1) * Math.PI / 180;
  const a = Math.sin(dLat/2)**2 +
            Math.cos(lat1*Math.PI/180) * Math.cos(lat2*Math.PI/180) *
            Math.sin(dLon/2)**2;
  return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
}

// ë°° ì´ë™
function moveShip() {
  const target = route[ship.routeIndex];
  const d = distance(ship.lat, ship.lon, target.lat, target.lon);

  if (d < 20) {
    ship.routeIndex = (ship.routeIndex + 1) % route.length;
    console.log("ë„ì°©:", target.lat, target.lon, "â†’ ë‹¤ìŒ í¬ì¸íŠ¸");
    return;
  }

  const ratio = speed / d;
  ship.lat += (target.lat - ship.lat) * ratio;
  ship.lon += (target.lon - ship.lon) * ratio;

  drawMap();
}

// ì§€ë„ ë° í¬ì¸íŠ¸ ê·¸ë¦¬ê¸°
function drawMap() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.drawImage(mapImage, 0, 0, canvas.width, canvas.height);

  // í•­êµ¬ (ë¹¨ê°„ ì )
  ports.forEach(p => {
    const {x, y} = latLonToXY(p.lat, p.lon, 2000, 1000);
    const adjX = x * (canvas.width / 2000);
    const adjY = y * (canvas.height / 1000);

    ctx.beginPath();
    ctx.arc(adjX, adjY, 6, 0, 2 * Math.PI);
    ctx.fillStyle = "red";
    ctx.fill();
    ctx.fillStyle = "black";
    ctx.fillText(p.port, adjX + 8, adjY - 5);
  });

  // í•´ìƒ ê²½ë¡œ (ì—°ê²°ì„ )
  ctx.beginPath();
  ctx.strokeStyle = "blue";
  ctx.lineWidth = 1.5;
  route.forEach((p, idx) => {
    const {x, y} = latLonToXY(p.lat, p.lon, 2000, 1000);
    const adjX = x * (canvas.width / 2000);
    const adjY = y * (canvas.height / 1000);
    if (idx === 0) ctx.moveTo(adjX, adjY);
    else ctx.lineTo(adjX, adjY);
  });
  ctx.stroke();

  // ë°° (íŒŒë€ ì )
  const {x, y} = latLonToXY(ship.lat, ship.lon, 2000, 1000);
  const adjX = x * (canvas.width / 2000);
  const adjY = y * (canvas.height / 1000);
  ctx.beginPath();
  ctx.arc(adjX, adjY, 8, 0, 2 * Math.PI);
  ctx.fillStyle = "blue";
  ctx.fill();
}

mapImage.onload = () => {
  drawMap();
  setInterval(moveShip, 5000); // 5ì´ˆë§ˆë‹¤ ì´ë™
};
</script>

</body>
</html>
